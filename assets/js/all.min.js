$.fn.extend({isOnScreenVisible:function(){var o=$(window),e={top:o.scrollTop(),left:o.scrollLeft()};e.right=e.left+o.width(),e.bottom=e.top+o.height();var t=this.offset();return t.right=t.left+this.outerWidth(),t.bottom=t.top+this.outerHeight(),!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom)}});var Duoshuo={dataThreadKey:location.protocol+"//"+location.host+location.pathname,init:function(){Duoshuo.toggleBox()},toggleBox:function(){$(".toggle-comment").on("click",function(){if(console.log("开启评论"),$(".comment-area").has("div").length>0)return void $(".comment-area").empty();var o=document.createElement("div");o.setAttribute("data-thread-key",Duoshuo.dataThreadKey),o.setAttribute("data-url",location.href),DUOSHUO.EmbedThread(o),$(".comment-area").append(o),setTimeout(function(){$(".comment-area").addClass("toggle-up")},500),setTimeout(function(){1==$(".comment-area").isOnScreenVisible()&&$(".toggle-comment").addClass("animated fadeOut").fadeOut(500)},1e3)})}},General={init:function(){General.scrollToPos(),General.checkKey(),General.updateImageWidth()},checkKey:function(o){o=o||window.event,"74"==o.keyCode?(console.log("按下键盘"),$("html,body").stop(),$("html,body").animate({scrollTop:$(window).stop().scrollTop()+200},"fast")):"75"==o.keyCode&&($("html,body").stop(),$("html,body").animate({scrollTop:$(window).stop().scrollTop()-200},"fast"))},updateImageWidth:function(){function o(){console.log(1);var o=$(this),e=t.outerWidth(),i=this.naturalWidth;i>=e?(o.addClass("full-img"),console.log("大图")):(o.removeClass("full-img"),console.log("小图"))}function e(){i.each(o)}var t=$(".post-content");t.fitVids();var i=$(".single-post-inner img").on("load",o);e()},urlIconlize:function(o){var e,t,i={twitter:"icon-twitter",qzone:"icon-qzone",weibo:"icon-weibo",facebook:"icon-facebook",github:"icon-github",douban:"icon-douban",google:"icon-google",luolei:"icon-luolei",dribble:"icon-dribble"};for(var n in i)if("function"!=typeof i[n]){var a=n;o.indexOf(a)>=0&&(e=a,t=i[a])}return t},addIcons:function(){$(".single-post-inner p a:not(:has(img))").each(function(){var o=$(this).attr("href"),e=document.createElement("a");e.href=o,_selfDomain=e.hostname,General.urlIconlize(_selfDomain),console.log(_selfDomain),$(this).prepend('<i class="iconfont '+General.urlIconlize(_selfDomain)+'"></i>');var t=$(this).find("i").css("color"),i=$(this).css("color");$(this).hover(function(){$(this).css("color",t),$(this).addClass("animated pulse")},function(){$(this).css("color",i),$(this).removeClass("animated pulse")})})},scrollToPos:function(o){var e="我要飞到最高",t=o||$(window).height(),i=$('<a href="#" id="to-top" title="'+e+'"> <div class="to-top-wrap"></div></a>').appendTo("body");$(window).scroll(function(){$(window).scrollTop()>$(window).height()?i.fadeIn(500):i.fadeOut(500)}),i.click(function(o){o.preventDefault(),$("html,body").animate({scrollTop:t-50},1e3,function(){window.location.hash="#"}),console.log("我跳")})},resize:function(){visualContainerWidh=$(window).width()}};$(document).ready(function(){General.init(),General.updateImageWidth(),Duoshuo.init(),$(".single-post-inner p:has(img)").each(function(){var o=$(this);o.addClass("with-img"),1==o.isOnScreenVisible()&&o.addClass("with-img").addClass("already-visible")}),$(".post-in-list").each(function(){var o=$(this);1==o.isOnScreenVisible()&&(console.log("可见"),o.addClass("already-visible"))}),$(".share h4").on("click",function(){$(".share-icons").css("display","block").addClass("fadeInUpBig animated"),$(this).fadeOut(500)}),$("#header").click(function(){return console.log("下滑"),$("html,body").animate({scrollTop:$(window).height()-20},1e3,function(){}),!1}),$("body").hasClass("post-template")&&(console.log("处理图标"),General.addIcons()),$(window).scroll(function(){$(window).scrollTop()>50,0==$(".share-icons").isOnScreenVisible()&&($(".share-icons").removeClass("fadeInUpBig animated").css("display","none"),$(".share h4").css("display","block")),($("body").hasClass("archive-template")||$("body").hasClass("home-template"))&&$(".post-in-list").each(function(){var o=$(this);1==o.isOnScreenVisible()&&1!=o.hasClass("already-visible")&&o.addClass("fadeInUpBig animated")})})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiXSwibmFtZXMiOlsiJCIsImZuIiwiZXh0ZW5kIiwiaXNPblNjcmVlblZpc2libGUiLCJ3aW4iLCJ3aW5kb3ciLCJ2aWV3cG9ydCIsInRvcCIsInNjcm9sbFRvcCIsImxlZnQiLCJzY3JvbGxMZWZ0IiwicmlnaHQiLCJ3aWR0aCIsImJvdHRvbSIsImhlaWdodCIsImJvdW5kcyIsInRoaXMiLCJvZmZzZXQiLCJvdXRlcldpZHRoIiwib3V0ZXJIZWlnaHQiLCJEdW9zaHVvIiwiZGF0YVRocmVhZEtleSIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJob3N0IiwicGF0aG5hbWUiLCJpbml0IiwidG9nZ2xlQm94Iiwib24iLCJjb25zb2xlIiwibG9nIiwiaGFzIiwibGVuZ3RoIiwiZW1wdHkiLCJlbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImhyZWYiLCJEVU9TSFVPIiwiRW1iZWRUaHJlYWQiLCJhcHBlbmQiLCJzZXRUaW1lb3V0IiwiYWRkQ2xhc3MiLCJmYWRlT3V0IiwiR2VuZXJhbCIsInNjcm9sbFRvUG9zIiwiY2hlY2tLZXkiLCJ1cGRhdGVJbWFnZVdpZHRoIiwiZSIsImV2ZW50Iiwia2V5Q29kZSIsInN0b3AiLCJhbmltYXRlIiwiJHRoaXMiLCJjb250ZW50V2lkdGgiLCIkcG9zdENvbnRlbnQiLCJpbWFnZVdpZHRoIiwibmF0dXJhbFdpZHRoIiwicmVtb3ZlQ2xhc3MiLCJjYXNwZXJGdWxsSW1nIiwiJGltZyIsImVhY2giLCJmaXRWaWRzIiwidXJsSWNvbmxpemUiLCJ1cmwiLCJkb21haW4iLCJfb3V0cHV0IiwiaWNvbk1hcCIsInR3aXR0ZXIiLCJxem9uZSIsIndlaWJvIiwiZmFjZWJvb2siLCJnaXRodWIiLCJkb3ViYW4iLCJnb29nbGUiLCJsdW9sZWkiLCJkcmliYmxlIiwibmFtZSIsIk1hcEtleSIsImluZGV4T2YiLCJhZGRJY29ucyIsIl9zcmMiLCJhdHRyIiwidG1wIiwiX3NlbGZEb21haW4iLCJob3N0bmFtZSIsInByZXBlbmQiLCJfc2VsZkNvbG9yIiwiZmluZCIsImNzcyIsIl9vcmlnaW5hbENvbG9yIiwiaG92ZXIiLCJwb3NpdGlvbiIsIlNUUl9UT19UT1AiLCJjb3ZlckhlaWdodCIsImJ1dHRvbiIsImFwcGVuZFRvIiwic2Nyb2xsIiwiZmFkZUluIiwiY2xpY2siLCJwcmV2ZW50RGVmYXVsdCIsImhhc2giLCJyZXNpemUiLCJ2aXN1YWxDb250YWluZXJXaWRoIiwicmVhZHkiLCJfdGhpcyIsImhhc0NsYXNzIl0sIm1hcHBpbmdzIjoiQUFBQUEsRUFBRUMsR0FBR0MsUUFDREMsa0JBQW1CLFdBQ2YsR0FBSUMsR0FBTUosRUFBRUssUUFDUkMsR0FDQUMsSUFBS0gsRUFBSUksWUFDVEMsS0FBTUwsRUFBSU0sYUFFZEosR0FBU0ssTUFBUUwsRUFBU0csS0FBT0wsRUFBSVEsUUFDckNOLEVBQVNPLE9BQVNQLEVBQVNDLElBQU1ILEVBQUlVLFFBRXJDLElBQUlDLEdBQVNDLEtBQUtDLFFBSWxCLE9BSEFGLEdBQU9KLE1BQVFJLEVBQU9OLEtBQU9PLEtBQUtFLGFBQ2xDSCxFQUFPRixPQUFTRSxFQUFPUixJQUFNUyxLQUFLRyxnQkFFeEJiLEVBQVNLLE1BQVFJLEVBQU9OLE1BQVFILEVBQVNHLEtBQU9NLEVBQU9KLE9BQVNMLEVBQVNPLE9BQVNFLEVBQU9SLEtBQU9ELEVBQVNDLElBQU1RLEVBQU9GLFVBS3hJLElBQUlPLFVBRUFDLGNBQWVDLFNBQVNDLFNBQVcsS0FBT0QsU0FBU0UsS0FBT0YsU0FBU0csU0FFbkVDLEtBQU0sV0FDRk4sUUFBUU8sYUFHWkEsVUFBVyxXQUVQM0IsRUFBRSxtQkFBbUI0QixHQUFHLFFBQVMsV0FFN0IsR0FEQUMsUUFBUUMsSUFBSSxRQUNSOUIsRUFBRSxpQkFBaUIrQixJQUFJLE9BQU9DLE9BQVMsRUFFdkMsV0FEQWhDLEdBQUUsaUJBQWlCaUMsT0FHdkIsSUFBSUMsR0FBS0MsU0FBU0MsY0FBYyxNQUNoQ0YsR0FBR0csYUFBYSxrQkFBbUJqQixRQUFRQyxlQUMzQ2Es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VyxXQUc5QjFGLEVBQUUsUUFBUTJHLFNBQVMscUJBQXVCM0csRUFBRSxRQUFRMkcsU0FBUyxtQkFDN0QzRyxFQUFFLGlCQUFpQjhELEtBQUssV0FDcEIsR0FBSTRDLEdBQVExRyxFQUFFZ0IsS0FDbUIsSUFBN0IwRixFQUFNdkcscUJBQW9FLEdBQXJDdUcsRUFBTUMsU0FBUyxvQkFDcERELEVBQU0vRCxTQUFTIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIkLmZuLmV4dGVuZCh7XG4gICAgaXNPblNjcmVlblZpc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgd2luID0gJCh3aW5kb3cpO1xuICAgICAgICB2YXIgdmlld3BvcnQgPSB7XG4gICAgICAgICAgICB0b3A6IHdpbi5zY3JvbGxUb3AoKSxcbiAgICAgICAgICAgIGxlZnQ6IHdpbi5zY3JvbGxMZWZ0KClcbiAgICAgICAgfTtcbiAgICAgICAgdmlld3BvcnQucmlnaHQgPSB2aWV3cG9ydC5sZWZ0ICsgd2luLndpZHRoKCk7XG4gICAgICAgIHZpZXdwb3J0LmJvdHRvbSA9IHZpZXdwb3J0LnRvcCArIHdpbi5oZWlnaHQoKTtcblxuICAgICAgICB2YXIgYm91bmRzID0gdGhpcy5vZmZzZXQoKTtcbiAgICAgICAgYm91bmRzLnJpZ2h0ID0gYm91bmRzLmxlZnQgKyB0aGlzLm91dGVyV2lkdGgoKTtcbiAgICAgICAgYm91bmRzLmJvdHRvbSA9IGJvdW5kcy50b3AgKyB0aGlzLm91dGVySGVpZ2h0KCk7XG5cbiAgICAgICAgcmV0dXJuICghKHZpZXdwb3J0LnJpZ2h0IDwgYm91bmRzLmxlZnQgfHwgdmlld3BvcnQubGVmdCA+IGJvdW5kcy5yaWdodCB8fCB2aWV3cG9ydC5ib3R0b20gPCBib3VuZHMudG9wIHx8IHZpZXdwb3J0LnRvcCA+IGJvdW5kcy5ib3R0b20pKTtcbiAgICB9XG59KTtcblxuXG52YXIgRHVvc2h1byA9IHtcblxuICAgIGRhdGFUaHJlYWRLZXk6IGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3QgKyBsb2NhdGlvbi5wYXRobmFtZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBEdW9zaHVvLnRvZ2dsZUJveCgpO1xuICAgIH0sXG5cbiAgICB0b2dnbGVCb3g6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICQoJy50b2dnbGUtY29tbWVudCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+W8gOWQr+ivhOiuuicpO1xuICAgICAgICAgICAgaWYgKCQoJy5jb21tZW50LWFyZWEnKS5oYXMoJ2RpdicpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAkKCcuY29tbWVudC1hcmVhJykuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnZGF0YS10aHJlYWQta2V5JywgRHVvc2h1by5kYXRhVGhyZWFkS2V5KTtcbiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnZGF0YS11cmwnLCBsb2NhdGlvbi5ocmVmKTtcbiAgICAgICAgICAgIERVT1NIVU8uRW1iZWRUaHJlYWQoZWwpO1xuICAgICAgICAgICAgJCgnLmNvbW1lbnQtYXJlYScpLmFwcGVuZChlbCk7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJCgnLmNvbW1lbnQtYXJlYScpLmFkZENsYXNzKCd0b2dnbGUtdXAnKTtcbiAgICAgICAgICAgIH0sIDUwMClcblxuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICgkKCcuY29tbWVudC1hcmVhJykuaXNPblNjcmVlblZpc2libGUoKSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy50b2dnbGUtY29tbWVudCcpLmFkZENsYXNzKCdhbmltYXRlZCBmYWRlT3V0JykuZmFkZU91dCg1MDApXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMTAwMClcblxuXG5cbiAgICAgICAgfSlcblxuICAgIH1cbn1cblxuXG5cblxuXG52YXIgR2VuZXJhbCA9IHtcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgR2VuZXJhbC5zY3JvbGxUb1BvcygpO1xuICAgICAgICBHZW5lcmFsLmNoZWNrS2V5KCk7XG4gICAgICAgIEdlbmVyYWwudXBkYXRlSW1hZ2VXaWR0aCgpO1xuICAgIH0sXG5cbiAgICAvL+aooeaLn+m8oOagh+S4iuS4i+a7muWKqFxuICAgIGNoZWNrS2V5OiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PSAnNzQnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygn5oyJ5LiL6ZSu55uYJyk7XG4gICAgICAgICAgICAkKCdodG1sLGJvZHknKS5zdG9wKCk7XG4gICAgICAgICAgICAkKCdodG1sLGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQod2luZG93KS5zdG9wKCkuc2Nyb2xsVG9wKCkgKyAyMDBcbiAgICAgICAgICAgIH0sICdmYXN0JylcbiAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzc1Jykge1xuICAgICAgICAgICAgJCgnaHRtbCxib2R5Jykuc3RvcCgpO1xuICAgICAgICAgICAgJCgnaHRtbCxib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKHdpbmRvdykuc3RvcCgpLnNjcm9sbFRvcCgpIC0gMjAwXG4gICAgICAgICAgICB9LCAnZmFzdCcpXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlSW1hZ2VXaWR0aDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkcG9zdENvbnRlbnQgPSAkKFwiLnBvc3QtY29udGVudFwiKTtcbiAgICAgICAgJHBvc3RDb250ZW50LmZpdFZpZHMoKTtcblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVJbWFnZVdpZHRoKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coMSk7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRXaWR0aCA9ICRwb3N0Q29udGVudC5vdXRlcldpZHRoKCksIC8vIFdpZHRoIG9mIHRoZSBjb250ZW50XG4gICAgICAgICAgICAgICAgaW1hZ2VXaWR0aCA9IHRoaXMubmF0dXJhbFdpZHRoOyAvLyBPcmlnaW5hbCBpbWFnZSByZXNvbHV0aW9uXG5cbiAgICAgICAgICAgIGlmIChpbWFnZVdpZHRoID49IGNvbnRlbnRXaWR0aCkge1xuICAgICAgICAgICAgICAgICR0aGlzLmFkZENsYXNzKCdmdWxsLWltZycpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCflpKflm74nKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHRoaXMucmVtb3ZlQ2xhc3MoJ2Z1bGwtaW1nJyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+Wwj+WbvicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyICRpbWcgPSAkKFwiLnNpbmdsZS1wb3N0LWlubmVyIGltZ1wiKS5vbignbG9hZCcsIHVwZGF0ZUltYWdlV2lkdGgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGNhc3BlckZ1bGxJbWcoKSB7XG4gICAgICAgICAgICAkaW1nLmVhY2godXBkYXRlSW1hZ2VXaWR0aCk7XG4gICAgICAgIH1cblxuICAgICAgICBjYXNwZXJGdWxsSW1nKCk7XG4gICAgfSxcblxuICAgIC8q57uZ5paH56ug5Lit55qEdXJs5re75YqgaWNvbmZvbnTmlrnkvr/or4bliKsqL1xuICAgIHVybEljb25saXplOiBmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgdmFyIGRvbWFpbixcbiAgICAgICAgICAgIF9vdXRwdXQ7XG4gICAgICAgIHZhciBpY29uTWFwID0geyAvKue0ouW8lSDlj6/lnKjov5nph4zmt7vliqDljLnphY3op4TliJkqL1xuICAgICAgICAgICAgJ3R3aXR0ZXInOiAnaWNvbi10d2l0dGVyJyxcbiAgICAgICAgICAgICdxem9uZSc6ICdpY29uLXF6b25lJyxcbiAgICAgICAgICAgICd3ZWlibyc6ICdpY29uLXdlaWJvJyxcbiAgICAgICAgICAgICdmYWNlYm9vayc6ICdpY29uLWZhY2Vib29rJyxcbiAgICAgICAgICAgICdnaXRodWInOiAnaWNvbi1naXRodWInLFxuICAgICAgICAgICAgJ2RvdWJhbic6ICdpY29uLWRvdWJhbicsXG4gICAgICAgICAgICAnZ29vZ2xlJzogJ2ljb24tZ29vZ2xlJyxcbiAgICAgICAgICAgICdsdW9sZWknOiAnaWNvbi1sdW9sZWknLFxuICAgICAgICAgICAgJ2RyaWJibGUnOiAnaWNvbi1kcmliYmxlJ1xuXG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBuYW1lIGluIGljb25NYXApIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaWNvbk1hcFtuYW1lXSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHZhciBNYXBLZXkgPSBuYW1lO1xuICAgICAgICAgICAgICAgIGlmICh1cmwuaW5kZXhPZihNYXBLZXkpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZG9tYWluID0gTWFwS2V5O1xuICAgICAgICAgICAgICAgICAgICBfb3V0cHV0ID0gaWNvbk1hcFtNYXBLZXldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfb3V0cHV0O1xuICAgIH0sXG5cbiAgICBhZGRJY29uczogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8q57uZ5Y2a5a6i5paH56ug5Zyw5Z2AdXJs5re75YqgaWNv6K+G5YirKi9cbiAgICAgICAgJCgnLnNpbmdsZS1wb3N0LWlubmVyIHAgYTpub3QoOmhhcyhpbWcpKScpLmVhY2goZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgdmFyIF9zcmMgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICAgIHZhciB0bXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICAgICAgICB0bXAuaHJlZiA9IF9zcmM7XG4gICAgICAgICAgICBfc2VsZkRvbWFpbiA9IHRtcC5ob3N0bmFtZTtcbiAgICAgICAgICAgIEdlbmVyYWwudXJsSWNvbmxpemUoX3NlbGZEb21haW4pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coX3NlbGZEb21haW4pO1xuICAgICAgICAgICAgLy8kKHRoaXMpLmFwcGVuZCh1cmxJY29ubGl6ZShfc2VsZkRvbWFpbikpO1xuICAgICAgICAgICAgJCh0aGlzKS5wcmVwZW5kKCc8aSBjbGFzcz1cImljb25mb250ICcgKyBHZW5lcmFsLnVybEljb25saXplKF9zZWxmRG9tYWluKSArICdcIj48L2k+Jyk7XG4gICAgICAgICAgICB2YXIgX3NlbGZDb2xvciA9ICQodGhpcykuZmluZCgnaScpLmNzcygnY29sb3InKSxcbiAgICAgICAgICAgICAgICBfb3JpZ2luYWxDb2xvciA9ICQodGhpcykuY3NzKCdjb2xvcicpO1xuXG4gICAgICAgICAgICAvKum8oOagh+aCrOa1ruaXtiovXG4gICAgICAgICAgICAkKHRoaXMpLmhvdmVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKCdjb2xvcicsIF9zZWxmQ29sb3IpO1xuICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2FuaW1hdGVkIHB1bHNlJyk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcygnY29sb3InLCBfb3JpZ2luYWxDb2xvcik7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnYW5pbWF0ZWQgcHVsc2UnKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+W5s+a7kea7muWKqOWIsOmhtumDqFxuICAgIHNjcm9sbFRvUG9zOiBmdW5jdGlvbihwb3NpdGlvbikge1xuICAgICAgICB2YXIgU1RSX1RPX1RPUCA9ICfmiJHopoHpo57liLDmnIDpq5gnLFxuICAgICAgICAgICAgY292ZXJIZWlnaHQgPSBwb3NpdGlvbiB8fCAkKHdpbmRvdykuaGVpZ2h0KCk7IC8v6I635b6X5Zu+54mH6auY5bqmXG4gICAgICAgIHZhciBidXR0b24gPSAkKCc8YSBocmVmPVwiI1wiIGlkPVwidG8tdG9wXCIgdGl0bGU9XCInICsgU1RSX1RPX1RPUCArICdcIj4gPGRpdiBjbGFzcz1cInRvLXRvcC13cmFwXCI+PC9kaXY+PC9hPicpLmFwcGVuZFRvKCdib2R5Jyk7XG4gICAgICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoJCh3aW5kb3cpLnNjcm9sbFRvcCgpID4gJCh3aW5kb3cpLmhlaWdodCgpKSB7XG4gICAgICAgICAgICAgICAgYnV0dG9uLmZhZGVJbig1MDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBidXR0b24uZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBidXR0b24uY2xpY2soZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJCgnaHRtbCxib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiBjb3ZlckhlaWdodCAtIDUwXG4gICAgICAgICAgICB9LCAxMDAwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9ICcjJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+aIkei3sycpO1xuICAgICAgICB9KVxuICAgIH0sXG4gICAgLy/lpITnkIblsY/luZXlj5jljJbml7ZcbiAgICByZXNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2aXN1YWxDb250YWluZXJXaWRoID0gJCh3aW5kb3cpLndpZHRoKCk7XG4gICAgICAgIC8vIGNvbnRlbnRXaWR0aD0kKCcucG9zdC1jb250ZW50Jykud2lkdGgoKTtcbiAgICAgICAgLy8gJCgnLnNpbmdsZS1wb3N0LWlubmVyIGltZycpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vICAgICB2YXIgX2ltZyA9ICQodGhpcyk7XG4gICAgICAgIC8vICAgICBjaGVja0ltZyhfaW1nKTtcbiAgICAgICAgLy8gfSlcbiAgICB9XG5cblxuXG59XG5cblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgR2VuZXJhbC5pbml0KCk7XG4gICAgR2VuZXJhbC51cGRhdGVJbWFnZVdpZHRoKCk7XG4gICAgLy8g5Yqg6L295aSa6K+06K+E6K66XG4gICAgRHVvc2h1by5pbml0KCk7XG5cblxuXG4gICAgJCgnLnNpbmdsZS1wb3N0LWlubmVyIHA6aGFzKGltZyknKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSAkKHRoaXMpO1xuICAgICAgICBfdGhpcy5hZGRDbGFzcygnd2l0aC1pbWcnKTtcblxuICAgICAgICBpZiAoX3RoaXMuaXNPblNjcmVlblZpc2libGUoKSA9PSB0cnVlKSB7XG4gICAgICAgICAgICBfdGhpcy5hZGRDbGFzcygnd2l0aC1pbWcnKS5hZGRDbGFzcygnYWxyZWFkeS12aXNpYmxlJyk7XG4gICAgICAgIH1cblxuICAgIH0pXG5cblxuICAgICQoJy5wb3N0LWluLWxpc3QnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSAkKHRoaXMpO1xuICAgICAgICBpZiAoX3RoaXMuaXNPblNjcmVlblZpc2libGUoKSA9PSB0cnVlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygn5Y+v6KeBJyk7XG4gICAgICAgICAgICBfdGhpcy5hZGRDbGFzcygnYWxyZWFkeS12aXNpYmxlJylcbiAgICAgICAgfVxuICAgIH0pXG4gICAgJCgnLnNoYXJlIGg0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJy5zaGFyZS1pY29ucycpLmNzcygnZGlzcGxheScsICdibG9jaycpLmFkZENsYXNzKCdmYWRlSW5VcEJpZyBhbmltYXRlZCcpXG4gICAgICAgICQodGhpcykuZmFkZU91dCg1MDApO1xuXG4gICAgICAgIC8vIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vICAgICAkKCdodG1sLGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgLy8gICAgICAgICBzY3JvbGxUb3A6ICQoJyNzaGFyZS1pY29ucycpLm9mZnNldCgpLnRvcCAtICQod2luZG93KS5oZWlnaHQoKSAvIDJcbiAgICAgICAgLy8gICAgIH0sIDEwMDAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyAgICAgICAgIC8vIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJyMnO1xuICAgICAgICAvLyAgICAgfSk7XG4gICAgICAgIC8vIH0sIDEwMDApXG5cblxuICAgIH0pXG5cbiAgICAkKCcjaGVhZGVyJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfkuIvmu5EnKTtcbiAgICAgICAgJCgnaHRtbCxib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICBzY3JvbGxUb3A6ICQod2luZG93KS5oZWlnaHQoKSAtIDIwXG4gICAgICAgIH0sIDEwMDAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnIyc7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSlcblxuXG4gICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygncG9zdC10ZW1wbGF0ZScpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCflpITnkIblm77moIcnKTtcbiAgICAgICAgR2VuZXJhbC5hZGRJY29ucygpO1xuICAgIH1cblxuXG5cbiAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiA1MCkge1xuICAgICAgICAgICAgLy8gJCgnLm5hdi1oZWFkZXInKS5yZW1vdmVDbGFzcygnaGlkZScpLmFkZENsYXNzKCdmYWRlSW5Eb3duQmlnIGFuaW1hdGVkJylcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkKCcuc2hhcmUtaWNvbnMnKS5pc09uU2NyZWVuVmlzaWJsZSgpID09IGZhbHNlKSB7XG4gICAgICAgICAgICAkKCcuc2hhcmUtaWNvbnMnKS5yZW1vdmVDbGFzcygnZmFkZUluVXBCaWcgYW5pbWF0ZWQnKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpXG4gICAgICAgICAgICAkKCcuc2hhcmUgaDQnKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ2FyY2hpdmUtdGVtcGxhdGUnKSB8fCAkKCdib2R5JykuaGFzQ2xhc3MoJ2hvbWUtdGVtcGxhdGUnKSkge1xuICAgICAgICAgICAgJCgnLnBvc3QtaW4tbGlzdCcpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaXNPblNjcmVlblZpc2libGUoKSA9PSB0cnVlICYmIF90aGlzLmhhc0NsYXNzKCdhbHJlYWR5LXZpc2libGUnKSAhPSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmFkZENsYXNzKCdmYWRlSW5VcEJpZyBhbmltYXRlZCcpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vICQoJy5zaW5nbGUtcG9zdC1pbm5lciBwOmhhcyhpbWcpJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gICAgIHZhciBfdGhpcyA9ICQodGhpcyk7XG4gICAgICAgIC8vICAgICBpZiAoX3RoaXMuaXNPblNjcmVlblZpc2libGUoKSA9PSB0cnVlICYmIF90aGlzLmhhc0NsYXNzKCdhbHJlYWR5LXZpc2libGUnKSAhPSB0cnVlKSB7XG4gICAgICAgIC8vICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgX3RoaXMuYWRkQ2xhc3MoJ3dpdGgtaW1nJyk7XG4gICAgICAgIC8vICAgICAgICAgfSwgMjAwKVxuXG4gICAgICAgIC8vICAgICB9XG4gICAgICAgIC8vIH0pXG5cblxuXG4gICAgfSlcblxufSlcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==